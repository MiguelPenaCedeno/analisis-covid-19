---
title: "Taller aplicado"
output: pdf_document
date: "2025-02-06"
---

El siguiente taller aplicado lo realizaron: Miguel Ángel Peña Cedeño, Gabriel Puello, Valentina ..., Juan Jose...

1. SELECCIÓN Y DESCRIPCIÓN DE LA BASE DE DATOS

La base de datos seleccionada fue de "Casos_positivos_de_COVID-19_en_Colombia._(fecha de descarga).csv" tomada del siguiente link: https://www.datos.gov.co/Salud-y-Protecci-n-Social/Casos-positivos-de-COVID-19-en-Colombia-/gt2j-8ykr/about_data la hemos seleccionado ya que nos resulto 

Se trata de un dataset realizado por el Instituto Nacional de Salud acerca de los casos positivos de COVID-19 en Colombia, estos datos han sido recopilados desde 2020 y la ultima actualización fue realizada el 14 de agosto de 2024. Son sumamente relevantes en materia de salud para el país y su analisis puede arrojar datos valiosos para preparar mejor a la sociedad colombiana en caso de una futura pandemia ya que este se trata de un fenomeno que eventualmente volverá a ocurrir.

2. IDENTIFICACIÓN Y CLASIFICACIÓN DE LAS VARIABLES

Iniciamos nuestro analisis cargando las 3 librerias que usaremos a lo largo del documento, las dos primeras vistas en clase y la tercera nos ha resultado de utilidad para poder generar graficos mas amigables a la vista al momento de tener que representar valores grandes en variables. Adicionalmente vamos a crear una variable "db" que va a permitir trabajar mas facil con la base de datos y va a leer de un archivo en formato .csv, por ultimo, realizamos str(db) para empezar a ver de que forma está estructurado el dataset.

```{r}
library(dplyr)
library(ggplot2)
library(scales)

db <- read.csv("Casos_positivos_de_COVID-19_en_Colombia._20250210.csv")
str(db)
```

2. Encontramos un total de 23 variables y 6.390.971 observaciones en el dataset, de estas se realizo una selección intencional de las variables que consideramos mas relevantes para el analisis, ya que variables como "ID.de.caso" no resultaban especialmente utiles a la hora del analisis, nos quedamos con estas X variables:

 1. fecha.reporte.web           : chr  
 3. Fecha.de.notificación       : chr  
 4. Código.DIVIPOLA.departamento: int  
 5. Nombre.departamento         : chr  
 6. Código.DIVIPOLA.municipio   : int 
 7. Nombre.municipio            : chr  
 8.  Edad                      : Variable cuantitativa de razon
 9. Unidad.de.medida.de.edad    : int  
 10. Sexo                      : Variable cualitativa nominal              AQUI HACE FALTA EXPLICAR LAS VARIABLES
 11. Tipo.de.contagio          : Variable cualitativa nominal 
 $ Ubicación.del.caso          : chr  
 $ Estado                      : chr 
 $ Código.ISO.del.país         : int  
 $ Nombre.del.país             : chr  
 $ Recuperado                  : chr  
 $ Fecha.de.inicio.de.síntomas : chr 
 $ Fecha.de.muerte             : chr  
 $ Fecha.de.diagnóstico        : chr  
 $ Fecha.de.recuperación       : chr  
 $ Tipo.de.recuperación        : chr  
 $ Pertenencia.étnica          : int 
 $ Nombre.del.grupo.étnico     : chr  

3. ORGANIZACIÓN Y PRESENTACIÓN DE LOS DATOS

A continuacion hacemos la presentacion de los datos sirviendonos de una tabla de frecuencia que nos muestre la edad en intervalos de 10 años por el numero de casos de infeccion, esto para no tener que hacer 114 filas distintas en la tabla sino solo 12, vale la pena tener en cuenta que para esto tambien vamos a ignorar todos los valores nulos dentro de la variable.

```{r}

db <- read.csv("Casos_positivos_de_COVID-19_en_Colombia._20250210.csv")

bins <- seq(min(db$Edad, na.rm = TRUE), max(db$Edad, na.rm = TRUE), by = 10)

tabla_frecuencia <- db %>%
  mutate(Edad = cut(Edad, breaks = bins, include.lowest = TRUE)) %>%
  group_by(Edad) %>%
  summarise(n_personas = n())
tabla_frecuencia
```
A continuacion vamos a visualizar la misma tabla de frecuencia haciendo uso de un grafico de barras, aqui es donde nos resulto util la inclusion de la libreria (scales) en los valores del eje y.

```{r}
ggplot(tabla_frecuencia, aes(x = Edad, y = n_personas)) +
  geom_bar(stat = "identity", fill = "lightblue", color = "black", na.rm = TRUE) +
  labs(title = "Numero de casos Positivos por Edad", x = "Edades por intervalos de 10 años", y = "Cantidad de Personas") +
  scale_y_continuous(labels = comma) +
  theme_minimal()
```

Para continuar con la presentacion de los datos nos ayudaremos de una segunda tabla de frecuencias


En el siguiente analisis vamos a hacer un dataframe agrupando el numero de casos totales por dia por las fechas de diagnostico de infección

```{r}

db$Fecha.de.diagnóstico <- as.Date(db$Fecha.de.diagnóstico, format = "%Y-%m-%d")

casos_por_dia <- db %>%
  group_by(Fecha.de.diagnóstico) %>%
  summarise(n_casos = n())

ggplot(casos_por_dia, aes(x = Fecha.de.diagnóstico, y = n_casos)) +
  geom_line(color = "blue") +
  labs(title = "Número de Casos Positivos de COVID-19 por Día",
       x = "Fecha de Diagnóstico",
       y = "Número de Casos") +
  theme_minimal()
```
Gracias a la graficacion de este dataframe nos es visible en que momentos se presentaron los picos de infección, podriamos establecer 3 principales que serian: a inicios de 2021, a mitades de 2021 y finalmente a inicios de 2022.

4. MEDIDAS DE TENDENCIA CENTRAL

A continuacion vamos a calcular las medidas de tendencia central para las variables que consideramos relevantes hacer este tipo de analisis.

```{r}
mean(db$Edad)
median(db$Edad)

```
Encontramos que el promedio de edad de los casos positivos es de aproximadamente 40 años, y la mediana es de 38 años, lo que sugiere una distribución muy ligeramente sesgada.

Vamos a graficar la edad ya no por intervalos para ver si podemos visualizar esto mismo:

```{r}
ggplot(db, aes(x = Edad)) +
  geom_histogram(bins = 40, color = "black", fill = "skyblue", na.rm = TRUE) +
  labs(title = "Distribución del número de infecciones por edad",
    x = "Edades", y = "Número de personas") +
  theme_minimal()
```

5. MEDIDAS DE VARIABILIDAD

Ahora vamos a proceder con calcular las medidas de variabilidad:

```{r}
rango <- max(db$Edad) - min(db$Edad)
rango
sd(db$Edad)
var(db$Edad)
```

Encontramos que el rango de edades es de 113 años, lo cual indica una población muy diversa en cuanto a edad, desde recién nacidos hasta personas mayores de 100 años. La desviación estándar de aproximadamente 18.5 años, esto indica que las edades de los casos positivos presentan una alta dispersión respecto a la media, que es de 40 años. Esto sugiere que el COVID-19 afectó a personas de un amplio rango etario, no concentrado en un solo grupo de edad.

Por ultimo, la varianza nos indica cuánto varían las edades respecto al promedio. Aunque no es tan intuitiva como la desviación estándar (porque está en unidades al cuadrado), una varianza alta como esta refleja una dispersión considerable en los datos: hay personas muy jóvenes y personas muy mayores entre los casos positivos.

6. MEDIDAS DE POSICIÓN

Para las medidas de posición vamos a partir de la variable de edad:

```{r}
quantile(db$Edad, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)

quantile(db$Edad, seq(0.1, 0.9, 0.1), na.rm = TRUE)

quantile(db$Edad, probs = c(0.10, 0.25, 0.50, 0.75, 0.90), na.rm = TRUE)
```
Las medidas de posición muestran que los casos positivos de COVID-19 se distribuyen principalmente entre los 27 y 53 años. La edad mediana es de 38 años, lo que indica que la mitad de los casos se concentran por debajo de esa edad. Además, el 90% de los casos tiene 65 años o menos, lo cual sugiere que los contagios afectan principalmente a personas adultas jóvenes y de mediana edad.

7. APLICACIÓN DE DISTRIBUCIONES DE PROBABILIDAD

```{r}
library(dplyr)

db$Fecha.de.muerte <- as.Date(db$Fecha.de.muerte)

fallecimientos_por_dia <- db %>%
  filter(!is.na(Fecha.de.muerte)) %>%
  group_by(Fecha.de.muerte) %>%
  summarise(n_fallecidos = n())

lambda <- mean(fallecimientos_por_dia$n_fallecidos)
lambda

1 - ppois(150, lambda)  
ppois(140, lambda) - ppois(120, lambda)
```

De acuerdo con el modelo de distribución de Poisson, la cantidad diaria promedio de fallecimientos por COVID-19 es de aproximadamente 133 personas.

Existe una probabilidad del 61% de que en un día ocurran entre 121 y 140 fallecimientos, lo que representa el comportamiento más habitual.

En contraste, la probabilidad de que un día se presenten más de 150 muertes es del 6.2%, lo que sugiere que esos días corresponden a situaciones menos frecuentes, posiblemente asociadas a picos de saturación del sistema de salud.

8. APLICACIÓN DEL MODELO NORMAL

```{r}
1 - pnorm(40, mean(db$Edad, na.rm = TRUE), sd(db$Edad, na.rm = TRUE))

1 - pnorm(65, mean(db$Edad, na.rm = TRUE), sd(db$Edad, na.rm = TRUE))
```

9. BONO (BOXPLOT)

Para el bono hemos querido mirar un boxplot por estado para comparar las edades en el dataset, sin embargo nos hemos encontrado con el problema de que hay tanto valores nulos, como valores que se repiten de forma erronea unicamente porque se escriben con un caracter diferente, como es el caso de las mayusculas entre "leve", "Leve" y "LEVE", esto lo podemos observar aquí:


```{r}
ggplot(db, aes(x = Estado, y = Edad)) + geom_boxplot()
```


Debido a esto hemos eliminado los valores nulos y agrupado las categorias para que no se repitan y podamos tener una visualización de los datos mejor:

```{r}
library(dplyr)
library(ggplot2)

# 1. Normalizar texto y eliminar NA
db_limpio <- db %>%
  filter(!is.na(Estado)) %>%                   # eliminar NA
  mutate(Estado = tolower(Estado)) %>%         # pasar todo a minúsculas
  mutate(Estado = recode(Estado, 
                         "LEVE" = "Leve", # unificar etiquetas
                         "leve" = "Leve",
                         "grave" = "Grave",
                         "moderado" = "Moderado",
                         "fallecido" = "Fallecido")) %>%
  filter(Estado %in% c("Leve", "Grave", "Moderado", "Fallecido"))  # eliminar valores fuera de los deseados

ggplot(db_limpio, aes(x = Estado, y = Edad)) +
  geom_boxplot(fill = "lightblue") +
  labs(
    title = "Distribución de edad por estado del caso",
    x = "Estado del caso",
    y = "Edad"
  ) +
  theme_minimal()
```
El gráfico muestra una relación clara entre edad y gravedad del COVID-19. A medida que la edad aumenta, también lo hace la probabilidad de que el caso sea grave o termine en fallecimiento. Por el contrario, los casos leves predominan entre personas más jóvenes.


10. INTERPRETACIÓN DE RESULTADOS Y CONCLUSIONES
